{"version":3,"sources":["webpack:///./js/components/user-block/index.js","webpack:///./js/components/user-block/template.html"],"names":["template","require","data","user","store","state","action","userExists","recaptcha","key","recaptcha_key","response","loginForm","login","email","pass","remember","token","sec_token","ajax","sec","confirmUser","confirmPass","tokenLogin","ajaxUrl","url","methods","test","axios","post","then","next","waitLogin","Swal","window","location","reload","catch","error","sendLink","enterPass","recaptchaSuccess","recaptchaExpire","actionLogin","actionRegister","showFormRegister","showFormLogin","showFormUser","showFormEmail","computed","loggedIn","id","logoutLink","he","decode","logout"],"mappings":"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","file":"31.js","sourcesContent":["import store from '../../lib/store';\nimport he from 'he';\nimport axios from 'axios';\nimport Swal from 'sweetalert2';\nexport default {\n  template: require( './template.html' ),\n  data() {\n    return {\n      user: store.state.user,\n      action: 'login',\n      userExists: false,\n      recaptcha: {\n        key: store.state.recaptcha_key,\n        response: null\n      },\n      loginForm: {\n        action: 'mrklogin',\n        login: '',\n        email: '',\n        pass: '',\n        remember: true,\n        'g-recaptcha-response': '',\n        token: false,\n        sec_token: store.state.ajax.sec\n      },\n      confirmUser: '',\n      confirmPass: '',\n      tokenLogin: false,\n      // urlLogin: store.state.login,\n      // urlRegister: store.state.register\n      ajaxUrl: store.state.ajax.url\n    };\n  },\n  methods: {\n    login() {\n      if ( this.action != 'register' && this.loginForm.action == 'mrkregister' ) {\n        this.action = 'register';\n        if ( /.+@.+\\..+/.test( this.loginForm.login )) {\n          this.loginForm.email = this.loginForm.login;\n          this.loginForm.login = '';\n        }\n        return;\n      }\n      if (! this.recaptcha.response ) {\n        // TODO: warn\n        return;\n      }\n      this.loginForm['g-recaptcha-response'] = this.recaptcha.response;\n      this.loginForm.token = this.tokenLogin;\n      axios.post( this.ajaxUrl, this.loginForm )\n         .then( response => {\n           switch ( response.next ) {\n           case 'wrong-password':\n             this.action = 'login';\n             break;\n           case 'unknown-user':\n             this.action = 'unknown-user';\n             break;\n           case 'unknown-email':\n             this.action = 'unknown-email';\n             break;\n           case 'link-sent':\n             this.waitLogin();\n             // TODO: close form\n             break;\n           case 'success':\n             // success!\n             Swal( 'Successfully logged in! Welcome!' );\n             window.location.reload();\n           }\n         })\n         .catch( error => {\n           // sorry! try again\n           // if user doesn't exist, do register instead\n           // if (! /.+@.+\\..+/.test( this.loginForm.log ))\n           //   Swal(  \"email address please\" ); // .then( x => this.loginForm.log = x )\n           Swal( \"We're sorry! There was some problem. Please try again later\" );\n         });\n    },\n    waitLogin() {\n    },\n    sendLink() {\n      this.tokenLogin = true;\n    },\n    enterPass() {\n      this.tokenLogin = false;\n    },\n    recaptchaSuccess( response ) {\n      this.recaptcha.response = response;\n    },\n    recaptchaExpire( response ) {\n      this.recaptcha.response = '';\n    },\n    actionLogin() {\n      this.loginForm.action = 'mrklogin';\n    },\n    actionRegister() {\n      this.loginForm.action = 'mrkregister';\n    },\n    showFormRegister() {\n      this.action = 'register';\n    },\n    showFormLogin() {\n      this.action = 'login';\n    },\n    showFormUser() {\n      this.action = 'unknown-user';\n    },\n    showFormEmail() {\n      this.action = 'unknown-email';\n    }\n  },\n  computed: {\n    loggedIn() {\n      return this.user && this.user.id;\n    },\n    logoutLink() {\n      return he.decode( this.user.logout );\n    }\n  }\n};\n","module.exports = \"<b-dd id=\\\"user\\\">\\n  <template slot=\\\"button-content\\\">\\n    <span class=\\\"dashicons dashicons-admin-users\\\"></span>\\n    {{ loggedIn ? user.display_name: 'sign in' }}\\n  </template>\\n  <transition name=\\\"fast-fade\\\" mode=\\\"out-in\\\">\\n    <b-dd-item v-if=\\\"loggedIn\\\" :href=\\\"logoutLink\\\">log out</b-dd-item>\\n    <b-form v-else-if=\\\"action == 'unknown-user'\\\" @submit=\\\"login\\\">\\n      <b-alert show variant=\\\"warning\\\">We're sorry, we don't have that username\\n        on record. Please check and re-enter the username or use your email\\n        address. Hit sign-up to create a new account.</b-alert>\\n      <b-form-group id=\\\"login-username\\\"\\n                    label=\\\"email address\\\"\\n                    label-for=\\\"username\\\">\\n        <b-form-input id=\\\"username\\\"\\n                      type=\\\"email\\\"\\n                      v-model=\\\"loginForm.login\\\"\\n                      required></b-form-input>\\n      </b-form-group>\\n      <b-form-group class=\\\"login-actions\\\">\\n        <b-btn v-if=\\\"action != 'register'\\\" type=\\\"submit\\\" variant=\\\"primary\\\"\\n               name=\\\"wp-submit\\\" class=\\\"login-button\\\" value=\\\"Log in\\\"\\n               @click=\\\"actionLogin\\\">try again</b-btn>\\n        <span v-if=\\\"action != 'register'\\\">or</span>\\n        <b-btn type=\\\"submit\\\" variant=\\\"success\\\" name=\\\"wp-submit\\\"\\n               class=\\\"register-button\\\" value=\\\"Register\\\"\\n               @click=\\\"actionRegister\\\">sign-up</b-btn>\\n      </b-form-group>\\n    </b-form>\\n    <b-form v-else-if=\\\"action == 'unknown-email\\\" @submit=\\\"login\\\">\\n      <b-alert show variant=\\\"warning\\\">We're sorry, we have no record of that\\n      email address. If you entered the email incorrectly you can re-enter it\\n      below to retry. or hit sign-up to create an account</b-alert>\\n      <b-form-group id=\\\"login-email\\\"\\n                    label=\\\"email address\\\"\\n                    label-for=\\\"email\\\">\\n        <b-form-input id=\\\"email\\\"\\n                      type=\\\"email\\\"\\n                      v-model=\\\"loginForm.email\\\"\\n                      required></b-form-input>\\n      </b-form-group>\\n      <b-form-group class=\\\"login-actions\\\">\\n        <b-btn v-if=\\\"action != 'register'\\\" type=\\\"submit\\\" variant=\\\"primary\\\"\\n               name=\\\"wp-submit\\\" class=\\\"login-button\\\" value=\\\"Log in\\\"\\n               @click=\\\"actionLogin\\\">try again</b-btn>\\n        <span v-if=\\\"action != 'register'\\\">or</span>\\n        <b-btn type=\\\"submit\\\" variant=\\\"success\\\" name=\\\"wp-submit\\\"\\n               class=\\\"register-button\\\" value=\\\"Register\\\"\\n               @click=\\\"actionRegister\\\">sign-up</b-btn>\\n      </b-form-group>\\n    </b-form>\\n    <b-form v-else @submit=\\\"login\\\">\\n      <b-form-group id=\\\"login-username\\\"\\n                    :label=\\\"action == 'register' ? 'username'\\n                            : 'username or email address'\\\"\\n                    label-for=\\\"username\\\">\\n        <b-form-input id=\\\"username\\\"\\n                      :type=\\\"action == 'register' ? 'text' : 'email'\\\"\\n                      v-model=\\\"loginForm.login\\\"\\n                      required></b-form-input>\\n      </b-form-group>\\n      <transition name=\\\"fade-fast\\\">\\n        <b-form-group v-if=\\\"action == 'register'\\\"\\n                      id=\\\"login-email\\\"\\n                      label=\\\"email address\\\"\\n                      label-for=\\\"email\\\">\\n          <b-form-input id=\\\"email\\\"\\n                        type=\\\"email\\\"\\n                        v-model=\\\"loginForm.email\\\"\\n                        required></b-form-input>\\n        </b-form-group>\\n      </transition>\\n      <transition name=\\\"fade-fast\\\" mode=\\\"out-in\\\">\\n        <div id=\\\"login-password\\\" v-if=\\\"tokenLogin\\\">\\n          <b-alert show>An email will be sent with a link that will log you in\\n            when you click it. This link will expire in 10 minutes.</b-alert>\\n          <b-btn variant=\\\"link\\\" @click=\\\"enterPass\\\">enter password instead</b-btn>\\n        </div>\\n        <b-form-group v-else-if=\\\"action == 'register'\\\">\\n          <b-form-group id=\\\"login-password\\\"\\n                        label=\\\"password\\\"\\n                        label-for=\\\"password\\\">\\n            <b-form-input id=\\\"password\\\"\\n                          type=\\\"password\\\"\\n                          v-model=\\\"loginForm.pass\\\"\\n                          required></b-form-input>\\n          </b-form-group>\\n          <b-form-group id=\\\"login-confirm-password\\\"\\n                        label=\\\"password\\\"\\n                        label-for=\\\"confirm-password\\\">\\n            <b-form-input id=\\\"confirm-password\\\"\\n                          type=\\\"password\\\"\\n                          v-model=\\\"confirmPass\\\"\\n                          required></b-form-input>\\n          </b-form-group>\\n          <b-btn variant=\\\"link\\\" @click=\\\"sendLink\\\">email login link instead</b-btn>\\n        </b-form-group>\\n        <b-form-group v-else\\n                      id=\\\"login-password\\\"\\n                      label=\\\"password\\\"\\n                      label-for=\\\"password\\\">\\n          <b-form-input id=\\\"password\\\"\\n                        type=\\\"password\\\"\\n                        v-model=\\\"loginForm.pass\\\"\\n                        required></b-form-input>\\n          <b-btn variant=\\\"link\\\" @click=\\\"sendLink\\\">email login link instead</b-btn>\\n        </b-form-group>\\n      </transition>\\n      <b-form-group>\\n        <vue-recaptcha :sitekey=\\\"recaptcha.key\\\"\\n                       @verify=\\\"recaptchaSuccess\\\"\\n                       theme=\\\"dark\\\"></vue-recaptcha>\\n      </b-form-group>\\n      <b-form-group class=\\\"login-actions\\\">\\n        <b-btn v-if=\\\"action != 'register'\\\" type=\\\"submit\\\" variant=\\\"primary\\\"\\n               name=\\\"wp-submit\\\" class=\\\"login-button\\\" value=\\\"Log in\\\"\\n               @click=\\\"actionLogin\\\">login</b-btn>\\n        <span v-if=\\\"action != 'register'\\\">or</span>\\n        <b-btn type=\\\"submit\\\" variant=\\\"success\\\" name=\\\"wp-submit\\\"\\n               class=\\\"register-button\\\" value=\\\"Register\\\"\\n               @click=\\\"actionRegister\\\">sign-up</b-btn>\\n      </b-form-group>\\n    </b-form>\\n  </transition>\\n</b-dd>\\n\";"],"sourceRoot":""}