{"version":3,"sources":["webpack:///./js/components/subscription-menu/index.js","webpack:///./js/components/subscription-menu/template.html"],"names":["template","require","props","levels","type","Array","default","data","sstate","store","state","selectedLevel","storedLevels","wait","confirmed","fetching","order_fields","key","class","order","mounted","length","wp","api","loadPromise","done","wpapix","Membership","path","fetch","res","console","log","methods","setLevel","level","user","item","name","amount","billing_amount","_rowVariant","unsetLevel","getConfirmation","membership","window","setInterval","success","model","opt","id","currentLevel","clearInterval","setTimeout","error","computed","memberLevels","targetPost"],"mappings":"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","file":"25.js","sourcesContent":["import store from '../../lib/store';\nimport axios from 'axios';\nimport wpapix from '../../lib/wpapi';\nexport default {\n  template: require( './template.html' ),\n  props: {\n    levels: {\n      type: Array,\n      default: () => []\n    }\n  },\n  data() {\n    return {\n      sstate: store.state,\n      selectedLevel: false,\n      storedLevels: false,\n      wait: false,\n      confirmed: false,\n      fetching: false,\n      order_fields: [\n        { key:   'item',\n          class: 'col-8'\n        },\n        { key:   'amount',\n          class: 'col-4'\n        }\n      ],\n      order: []\n    };\n  },\n  mounted() {\n    if (! this.levels.length )\n      wp.api.loadPromise.done(() => {\n        var levels = new wpapix.Membership({ path: 'levels' });\n        levels.fetch().done( res => {\n          console.log( 'got membership levels', res );\n          this.storedLevels = res;\n        });\n      });\n  },\n  methods: {\n    setLevel( level ) {\n      if (! this.user ) {\n        // redirect to login, then continue\n      }\n      this.selectedLevel = level;\n      this.order = [{ item: level.name, amount: level.billing_amount },\n                    { item: \"Total\",    amount: level.billing_amount,\n                      _rowVariant: 'secondary' }];\n    },\n    unsetLevel() {\n      this.selectedLevel = false;\n    },\n    getConfirmation() {\n      var membership = wpapix.Membership({ path: 'my-level' });\n      this.fetching = false;\n      this.wait = window.setInterval( () => {\n        if ( this.fetching )\n          return;\n        this.fetching = true;\n        membership.fetch({\n          success: ( model, res, opt ) => {\n            if ( res && res.id != this.currentLevel.id ) {\n              this.confirmed = true;\n              this.user.membership = res;\n              window.clearInterval( this.wait );\n              this.wait = false;\n              window.setTimeout( () => { this.fetching = false; }, 250 );\n            }\n          },\n          error: ( model, res, opt ) => {\n            this.fetching = false;\n          }\n        });\n      }, 2500);\n    }\n  },\n  computed: {\n    user() {\n      return this.sstate.user;\n    },\n    memberLevels() {\n      return ( this.levels.length ? this.levels : this.storedLevels );\n    },\n    currentLevel() {\n      return this.user && this.user.membership || false;\n    },\n    targetPost() { return false; }\n  }\n};\n","module.exports = \"<div class=\\\"subscription-menu container\\\">\\n  <transition name=\\\"fade-fast\\\" mode=\\\"out-in\\\">\\n    <div v-if=\\\"confirmed\\\" class=\\\"row success\\\" key=\\\"success\\\">\\n      <h2>Success!</h2>\\n      <div class=\\\"welcome col-12\\\">You've succesfully signed up for the {{\\n        currentLevel.name }} package. <span v-if=\\\"targetPost\\\">You can now see\\n          the content you were trying to view\\n          <router-link :to=\\\"targetPost.path\\\">here</router-link>.</span>\\n      </div>\\n    </div>\\n    <div v-else-if=\\\"selectedLevel\\\" class=\\\"confirm container\\\" key=\\\"confirm\\\">\\n      <h2 class=\\\"message\\\">Confirm Order</h2>\\n      <b-table striped hover :items=\\\"order\\\" :fields=\\\"order_fields\\\"\\n               class=\\\"order\\\"></b-table>\\n      <div class=\\\"row\\\">\\n        <div class=\\\"col-8\\\"></div>\\n        <b-button class=\\\"col-2 cancel\\\" href=\\\"#\\\" @click.native.stop=\\\"unsetLevel\\\"\\n                  variant=\\\"link\\\">\\n          go back\\n        </b-button>\\n        <b-button variant=\\\"primary\\\"\\n                  :to=\\\"{ name:'members-checkout', query: {\\n                         level: selectedLevel.id,\\n                         'submit-checkout': 1,\\n                         checkjavascript: 1,\\n                         javascriptok: 1\\n                       }}\\\"\\n                  class=\\\"col-2 submit confirm checkout paypal paypal-express\\\"\\n                  target=\\\"_blank\\\">checkout</b-button>\\n      </div>\\n    </div>\\n    <div v-else class=\\\"row\\\" key=\\\"select\\\">\\n      <div v-for=\\\"level in memberLevels\\\" :key=\\\"level.id\\\"\\n           class=\\\"col-12 col-md-4\\\">\\n        <b-card no-body class=\\\"member-level\\\" :header=\\\"level.name\\\">\\n          <b-card-body>\\n            <div class=\\\"description\\\" v-html=\\\"level.description\\\"></div>\\n            <div class=\\\"price\\\">${{ level.billing_amount }}</div>\\n          </b-card-body>\\n          <b-card-footer v-if=\\\"currentLevel.id == level.id\\\" class=\\\"selected\\\">\\n            expires {{ user.membership.expires }}\\n          </b-card-footer>\\n          <b-card-footer v-else class=\\\"buy\\\">\\n            <!-- <router-link :to=\\\"'/members/signup/' + level.id\\\"></router-link> -->\\n            <a href=\\\"#\\\" @click.stop=\\\"setLevel( level )\\\">{{\\n              user ? 'select' : 'sign up'\\n              }}</a>\\n          </b-card-footer>\\n        </b-card>\\n      </div>\\n    </div>\\n  </transition>\\n</div>\\n\";"],"sourceRoot":""}