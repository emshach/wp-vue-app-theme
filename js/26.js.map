{"version":3,"sources":["webpack:///./js/components/subscription-menu/index.js","webpack:///./js/components/subscription-menu/template.html"],"names":["template","require","props","levels","type","Array","default","target","String","data","sstate","store","state","selectedLevel","storedLevels","wait","confirmed","fetching","order_fields","key","class","label","order","mounted","length","wp","api","loadPromise","done","wpapix","Membership","path","fetch","res","console","log","methods","setLevel","level","user","item","name","amount","billing_amount","_rowVariant","unsetLevel","getConfirmation","e","window","open","id","membership","setInterval","success","model","opt","currentLevel","clearInterval","setTimeout","error","computed","memberLevels","targetPost"],"mappings":"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","file":"26.js","sourcesContent":["import store from '../../lib/store';\nimport axios from 'axios';\nimport wpapix from '../../lib/wpapi';\nexport default {\n  template: require( './template.html' ),\n  props: {\n    levels: {\n      type: Array,\n      default: () => []\n    },\n    target: {\n      type: String,\n      default: ''\n    }\n  },\n  data() {\n    return {\n      sstate: store.state,\n      selectedLevel: false,\n      storedLevels: false,\n      wait: false,\n      confirmed: false,\n      fetching: false,\n      order_fields: [\n        { key:   'item',\n          class: 'col-8'\n        },\n        { key:   'amount',\n          label: 'Amount (USD)',\n          class: 'col-4'\n        }\n      ],\n      order: []\n    };\n  },\n  mounted() {\n    if (! this.levels.length )\n      wp.api.loadPromise.done(() => {\n        var levels = new wpapix.Membership({ path: 'levels' });\n        levels.fetch().done( res => {\n          console.log( 'got membership levels', res );\n          this.storedLevels = res;\n        });\n      });\n  },\n  methods: {\n    setLevel( level ) {\n      if (! this.user ) {\n        // redirect to login, then continue\n      }\n      this.selectedLevel = level;\n      this.order = [{ item: level.name, amount: level.billing_amount },\n                    { item: \"Total\",    amount: level.billing_amount,\n                      _rowVariant: 'secondary' }];\n    },\n    unsetLevel() {\n      this.selectedLevel = false;\n    },\n    getConfirmation( e, level ) {\n      window.open('/members/checkout?level=' + this.selectedLevel.id\n                  + '&submit-checkout=1&checkjavascript=1&javascriptok=1', '_blank' );\n      var membership = new wpapix.Membership({ path: 'my-level' });\n      this.fetching = false;\n      this.wait = window.setInterval( () => {\n        if ( this.fetching )\n          return;\n        this.fetching = true;\n        membership.fetch({\n          success: ( model, res, opt ) => {\n            if ( res && res.id != this.currentLevel.id ) {\n              this.confirmed = true;\n              this.user.membership = res;\n              window.clearInterval( this.wait );\n              this.wait = false;\n              window.setTimeout( () => { this.fetching = false; }, 250 );\n            } else {\n              this.fetching = false;\n            }\n          },\n          error: ( model, res, opt ) => {\n            this.fetching = false;\n          }\n        });\n      }, 2500);\n    }\n  },\n  computed: {\n    user() {\n      return this.sstate.user;\n    },\n    memberLevels() {\n      return ( this.levels.length ? this.levels : this.storedLevels );\n    },\n    currentLevel() {\n      return this.user && this.user.membership || false;\n    },\n    targetPost() { return this.target; }\n  }\n};\n","module.exports = \"<div class=\\\"subscription-menu container\\\">\\n  <transition name=\\\"fade-fast\\\" mode=\\\"out-in\\\">\\n    <div v-if=\\\"confirmed\\\" class=\\\"row success\\\" key=\\\"success\\\">\\n      <h2>Success!</h2>\\n      <div class=\\\"welcome col-12\\\">You've succesfully signed up for the {{\\n        currentLevel.name }} package. <span v-if=\\\"targetPost\\\">You can now see\\n          the content you were trying to view\\n          <router-link :to=\\\"targetPost\\\">here</router-link>.</span>\\n      </div>\\n    </div>\\n    <div v-else-if=\\\"selectedLevel\\\" class=\\\"confirm container\\\" key=\\\"confirm\\\">\\n      <h2 class=\\\"message\\\">Confirm Order</h2>\\n      <b-table striped hover :items=\\\"order\\\" :fields=\\\"order_fields\\\" stacked=\\\"sm\\\"\\n               class=\\\"order\\\"></b-table>\\n      <div class=\\\"actions\\\">\\n        <b-button class=\\\"col-2 submit confirm checkout paypal paypal-express\\\"\\n                  @click.stop=\\\"getConfirmation\\\"\\n                  variant=\\\"warning\\\">checkout</b-button>\\n        <b-button class=\\\"col-2 cancel\\\" @click.stop=\\\"unsetLevel\\\"\\n                  variant=\\\"link\\\">go back</b-button>\\n      </div>\\n    </div>\\n    <div v-else class=\\\"row\\\" key=\\\"select\\\">\\n      <div v-for=\\\"level in memberLevels\\\" :key=\\\"level.id\\\"\\n           class=\\\"col-12 col-md-4\\\">\\n        <b-card no-body class=\\\"member-level\\\" :header=\\\"level.name\\\">\\n          <b-card-body>\\n            <div class=\\\"description\\\" v-html=\\\"level.description\\\"></div>\\n            <div class=\\\"price\\\">${{ level.billing_amount }}</div>\\n          </b-card-body>\\n          <b-card-footer v-if=\\\"currentLevel.id == level.id\\\" class=\\\"selected\\\">\\n            expires {{ user.membership.expires }}\\n          </b-card-footer>\\n          <b-card-footer v-else class=\\\"buy\\\">\\n            <!-- <router-link :to=\\\"'/members/signup/' + level.id\\\"></router-link> -->\\n            <a href=\\\"#\\\" @click.stop=\\\"setLevel( level )\\\">{{\\n              user ? 'select' : 'sign up'\\n              }}</a>\\n          </b-card-footer>\\n        </b-card>\\n      </div>\\n    </div>\\n  </transition>\\n</div>\\n\";"],"sourceRoot":""}