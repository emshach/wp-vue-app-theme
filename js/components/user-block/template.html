<b-dd id="user">
  <template slot="button-content">
    <span class="dashicons dashicons-admin-users"></span>
    {{ loggedIn ? user.display_name: 'sign in' }}
  </template>
  <!-- <transition name="fast-fade">
    <b-dd-item v-if="loggedIn" :href=""></b-dd-item>
  </transition> -->
  <transition name="fast-fade" mode="out-in">
    <b-dd-item v-if="loggedIn" :href="logoutLink">log out</b-dd-item>
    <div v-else-if="action == 'success'" id="login" class="feedback"
         :style="messageStyle">
      <div class="message">Success! The page should reload with you logged in.
        If it takes too long, click the button to reload.</div>
      <b-btn variant="primary" @click="reload"
             class="mid-button">reload</b-btn>
      <!-- <b-btn type="submit" variant="success" name="wp-submit" -->
      <!--        class="register-button" value="Register" -->
      <!--        @click="actionRegister">sign-up</b-btn> -->
    </div>
    <div v-else-if="action == 'success-email'" id="login" class="feedback"
         :style="messageStyle">
      <div class="message">Success! Please check your mail and follow the
        confirmation link to complete registration</div>
      <div class="login-actions">
        <b-btn v-if="loginConfirmed" variant="primary"
               class="mid-button">OK</b-btn>
      </div>
    </div>
    <div v-else-if="action == 'link-sent'" id="login" class="feedback"
         :style="messageStyle">
      <div class="message">Your login link has been sent. This page
        should reload once you've been logged in. If not, click the button to
        reload</div>
      <div class="login-actions">
        <b-btn v-if="loginConfirmed" variant="primary" @click="reload"
               class="mid-button">reload</b-btn>
      </div>
    </div>
    <div v-else-if="action == 'not-registered'" id="login" class="feedback"
         :style="messageStyle">
      <div class="message">The username <strong>{{ loginForm.login }}</strong>
        is not registered. Would you like to sign up?</div>
      <div class="login-actions">
        <b-btn variant="link" @click="goBack"
               class="login-button">go back</b-btn>
        <b-btn variant="success" @click="register"
               class="register-button">sign-up</b-btn>
      </div>
    </div>
    <div v-else-if="action == 'email-exists'" id="login" class="feedback"
         :style="messageStyle">
      <template v-if="loginForm.token">
        <div class="message">The email
          <strong>{{ loginForm.email }}</strong> is already registered. If this
          email is correct, click confirm to get your login link, or go back to
          change it</div>
        <div class="login-actions">
          <b-btn variant="link" @click="goBack"
                 class="login-button">go back</b-btn>
          <b-btn variant="success" @click="confirm"
                 class="register-button">confirm</b-btn>
        </div>
      </template>
      <template v-else>
        <div class="message">The email
          <strong>{{ loginForm.email }}</strong> is already registered but does
          not match the password given. If this email is correct, click login to
          try again, or click forgot password and a login link will be sent to
          you.</div>
        <div class="login-actions">
          <b-btn variant="link" @click="goToLogin"
                 class="login-button">login</b-btn>
          <b-btn variant="success" @click="confirm"
                 class="register-button">forgot password</b-btn>
        </div>
      </template>
    </div>
    <b-form v-else-if="action == 'unknown-user'" @submit="login"
            id="login" ref="loginForm"
            @click="formClick"
            :class="[ 'login', action ]">
      <b-alert show variant="warning">We're sorry, we don't have that username
        on record. Please check and re-enter the username or use your email
        address. Hit sign-up to create a new account.</b-alert>
      <b-form-group id="login-username"
                    label="email address"
                    label-for="username">
        <b-form-input id="username" ref="firstInput"
                      type="text"
                      v-model="loginForm.login"
                      required></b-form-input>
      </b-form-group>
      <b-form-group class="login-actions">
        <b-btn type="submit" variant="primary"
               name="wp-submit" class="login-button" value="Log in"
               @click="actionLogin">try again</b-btn>
        <b-btn type="submit" variant="success" name="wp-submit"
               class="register-button" value="Register"
               @click="actionRegister">sign-up</b-btn>
      </b-form-group>
    </b-form>
    <b-form v-else-if="action == 'unknown-email'" @submit="login"
            id="login" ref="loginForm"
            @click="formClick"
            :class="[ 'login', action ]">
      <b-alert show variant="warning">We're sorry, we have no record of that
      email address. If you entered the email incorrectly you can re-enter it
      below to retry. or hit sign-up to create an account</b-alert>
      <b-form-group id="login-email"
                    label="email address"
                    label-for="email">
        <b-form-input id="email" ref="firstInput"
                      type="email"
                      v-model="loginForm.email"
                      required></b-form-input>
      </b-form-group>
      <b-form-group class="login-actions">
        <b-btn type="submit" variant="primary"
               name="wp-submit" class="login-button" value="Log in"
               @click="actionLogin">try again</b-btn>
        <b-btn type="submit" variant="success" name="wp-submit"
               class="register-button" value="Register"
               @click="actionRegister">sign-up</b-btn>
      </b-form-group>
    </b-form>
    <b-form v-else @submit="login"
            id="login" ref="loginForm"
            @click="formClick"
            :class="[ 'login', action ]">
      <transition name="fade-fast">
        <b-form-group v-if="errors.length">
          <b-alert v-for="( error, index ) in errors" variant="danger" show
                   :key="index" v-html="error"></b-alert>
        </b-form-group>
      </transition>
      <b-form-group id="login-username"
                    :label="action == 'register' ? 'username'
                            : 'username or email address'"
                    label-for="username">
        <b-form-input id="username" ref="firstInput"
                      type="text"
                      v-model="loginForm.login"
                      required></b-form-input>
      </b-form-group>
      <transition name="fade-fast">
        <b-form-group v-if="action == 'register'"
                      id="login-email"
                      label="email address"
                      label-for="email">
          <b-form-input id="email"
                        type="email"
                        v-model="loginForm.email"
                        required></b-form-input>
        </b-form-group>
      </transition>
      <transition name="fade-fast" mode="out-in">
        <div id="login-password" v-if="tokenLogin">
          <template v-if="action == 'register'">
            <b-alert show>A password will be generated
              for you and sent with your confirmation email.</b-alert>
            <b-btn variant="link" @click="enterPass">set password now</b-btn>
          </template>
          <template v-else>
            <b-alert show>An email will be sent with a link that will log
              you in when you click it. This link will expire in 10
              minutes.</b-alert>
            <b-btn variant="link" @click="enterPass">enter password instead</b-btn>
          </template>
        </div>
        <b-form-group v-else-if="action == 'register'"
                      id="login-password">
          <b-form-group id="login-password1"
                        label="password"
                        label-for="password1">
            <b-form-input id="password1"
                          type="password"
                          v-model="loginForm.pass"
                          required></b-form-input>
          </b-form-group>
          <b-form-group id="login-password1"
                        label="confirm password"
                        label-for="password2">
            <b-form-input id="password2"
                          type="password"
                          v-model="confirmPass"
                          required></b-form-input>
          </b-form-group>
          <b-btn variant="link" @click="sendLink">don't set password now</b-btn>
        </b-form-group>
        <b-form-group v-else
                      id="login-password"
                      label="password"
                      label-for="password">
          <b-form-input id="password"
                        type="password"
                        v-model="loginForm.pass"
                        required></b-form-input>
          <b-btn variant="link" @click="sendLink">email login link instead</b-btn>
        </b-form-group>
      </transition>
      <transition name="fade-in">
        <b-form-group v-if="recaptcha.show || !recaptcha.response">
          <vue-recaptcha :sitekey="recaptcha.key"
                         @rendered="recaptchaShow"
                         @verify="recaptchaSuccess"
                         @expired="recaptchaExpired"
                         theme="dark"></vue-recaptcha>
        </b-form-group>
      </transition>
      <b-form-group class="login-actions">
        <b-btn v-if="action != 'register'" type="submit" variant="primary"
               name="wp-submit" class="login-button" value="Log in"
               @click="actionLogin">login</b-btn>
        <b-btn v-else variant="link" @click="clearForm"
               class="login-button">cancel</b-btn>
        <span v-if="action != 'register'">or</span>
        <b-btn type="submit" variant="success" name="wp-submit"
               class="register-button" value="Register"
               @click="actionRegister">sign-up</b-btn>
      </b-form-group>
    </b-form>
  </transition>
</b-dd>
