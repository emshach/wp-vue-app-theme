<section class="episodes">
  <template v-if="filteredEpisodes.length || showEmpty">
    <h2 class="title" v-html="title"></h2>
    <transition-group name="fade-fast">
      <b-card v-for="( episode, index ) in filteredEpisodes" :key="episode.id">
        <b-media no-body>
          <b-media-aside>
            <b-img :src="episode.thumbnail" width="128" height="96" />
            <div class="info length">{{
              episode.media_details.length_formatted
              }}</div>
          </b-media-aside>
          <b-media-body>
            <h5 v-if="labels && episode.release_number
                      && typeOf episode.release_number == 'number'"
                class="mt-0 episode-num">Programme {{
              episode.release_number }}</h5>
            <h5 class="mt-0" v-html="episode.title.rendered"></h5>
            <div class="info row">
              <div :class="[ 'views', 'd-flex',
                           { active : episode.my_xp.seen }]">
                <span class="dashicons dashicons-visibility"></span>
                <span class="count">{{ episode.stats.views || 0 }}</span>
              </div>
              <div :class="[ 'likes',  'd-flex',
                           { active: episode.my_xp.like }]">
                <span class="dashicons dashicons-thumbs-up"></span>
                <span class="count">{{ episode.stats.likes || 0 }}</span>
              </div>
              <div :class="[ 'dislikes', 'd-flex',
                           { active: episode.my_xp.dislike }]">
                <span class="dashicons dashicons-thumbs-down"></span>
                <span class="count">{{ episode.stats.dislikes || 0 }}</span>
              </div>
              <div :class="[ 'favs', 'd-flex', { active: episode.my_xp.fav }]">
                <span class="dashicons dashicons-star-filled"></span>
                <span class="count">{{ episode.stats.favs || 0 }}</span>
              </div>
              <div :class="[ 'comments', 'd-flex',
                           { active: episode.my_xp.comment }]">
                <span class="dashicons dashicons-admin-comments"></span>
                <span class="count">{{ episode.stats.comments || 0 }}</span>
              </div>
              <template v-if="user.as && user.as.admin">
                <div v-if="episode.restrictions.private"
                     class="d-flex admin">private</div>
                <div v-if="episode.restrictions.public"
                     class="d-flex admin">public</div>
                <div v-if="episode.restrictions.auth"
                     class="d-flex admin">logged-in</div>
                <div v-if="episode.restrictions.payperview"
                     class="d-flex admin">payperview</div>
                <div v-if="episode.restrictions.members"
                     class="d-flex admin">subscribers</div>
                <div v-if="!episode.restrictions.show
                           && !episode.restrictions.public"
                     class="d-flex admin">hidden</div>
                <!-- <div v-if="episode.restrictions.premium"
                     class="d-flex admin">premium</div> -->
              </template>
            </div>
            <div v-html="episode.caption.rendered"></div>
            <b-btn v-if="canWatchNow( episode )" :to="episode.path" size="lg"
                   class="watch watch-now" variant="primary">
              {{ sayAction( episode )}} now</b-btn>
            <b-btn v-else-if="needsSubscription( episode )" size="lg"
                   :to="episode.preview
                        ||{ path: '/members', query: { then: episode.path }}"
                   class="watch subscribe-to-watch"
                   variant="warning">subscribe to {{ sayAction( episode ) }}</b-btn>
            <b-btn v-if="episode.preview" class="watch watch-preview" size="lg"
                   :to="episode.preview" variant="link">
              {{ sayAction( episode, true ) }} preview</b-btn>
          </b-media-body>
        </b-media>
      </b-card>
    </transition-group>
    <div v-if="!filteredEpisodes.length && !hideComing"
         class="message">Coming {{ dateComing }}!</div>
  </template>
</section>
