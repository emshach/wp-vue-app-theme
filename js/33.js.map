{"version":3,"sources":["webpack:///./js/components/subscription-menu/index.js","webpack:///./js/components/subscription-menu/template.html"],"names":["template","require","props","levels","type","Array","default","target","String","data","sstate","store","state","selectedLevel","storedLevels","wait","confirmed","fetching","order_fields","key","class","label","order","mounted","length","_wpapix","then","wpapix","Membership","path","fetch","done","res","console","log","methods","setLevel","level","user","currentLevel","id","item","name","amount","billing_amount","_rowVariant","unsetLevel","getConfirmation","e","window","open","membership","setInterval","success","model","opt","clearInterval","setTimeout","error","computed","memberLevels","as","subscriber","targetPost"],"mappings":"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","file":"33.js","sourcesContent":["import store from '../../lib/store';\nimport axios from 'axios';\nimport _wpapix from '../../lib/wpapix';\nexport default {\n  template: require( './template.html' ),\n  props: {\n    levels: {\n      type: Array,\n      default: () => []\n    },\n    target: {\n      type: String,\n      default: ''\n    }\n  },\n  data() {\n    return {\n      sstate: store.state,\n      selectedLevel: false,\n      storedLevels: false,\n      wait: false,\n      confirmed: false,\n      fetching: false,\n      order_fields: [\n        { key:   'item',\n          class: 'col-8'\n        },\n        { key:   'amount',\n          label: 'Amount (USD)',\n          class: 'col-4'\n        }\n      ],\n      order: []\n    };\n  },\n  mounted() {\n    if (! this.levels.length )\n      _wpapix.then( wpapix => {\n        var levels = new wpapix.Membership({ path: 'levels' });\n        levels.fetch().done( res => {\n          console.log( 'got membership levels', res );\n          this.storedLevels = res;\n        });\n      });\n  },\n  methods: {\n    setLevel( level ) {\n      if (! this.user ) {\n        // redirect to login, then continue\n      }\n      if ( this.currentLevel && this.currentLevel.id == level.id )\n        return;\n      this.selectedLevel = level;\n      this.order = [{ item: level.name, amount: level.billing_amount },\n                    { item: \"Total\",    amount: level.billing_amount,\n                      _rowVariant: 'secondary' }];\n    },\n    unsetLevel() {\n      this.selectedLevel = false;\n    },\n    getConfirmation( e, level ) {\n      window.open('/members/checkout?level=' + this.selectedLevel.id\n                  + '&submit-checkout=1&checkjavascript=1&javascriptok=1', '_blank' );\n      _wpapix.then( wpapix => {\n        var membership = new wpapix.Membership({ path: 'my-level' });\n        this.fetching = false;\n        this.wait = window.setInterval( () => {\n          if ( this.fetching )\n            return;\n          this.fetching = true;\n          membership.fetch({\n            success: ( model, res, opt ) => {\n              if ( res && res.id != this.currentLevel.id ) {\n                this.confirmed = true;\n                this.user.membership = res;\n                window.clearInterval( this.wait );\n                this.wait = false;\n                window.setTimeout( () => { this.fetching = false; }, 250 );\n              } else {\n                this.fetching = false;\n              }\n            },\n            error: ( model, res, opt ) => {\n              this.fetching = false;\n            }\n          });\n        }, 2500);\n      });\n    }\n  },\n  computed: {\n    user() {\n      return this.sstate.user;\n    },\n    memberLevels() {\n      return ( this.levels.length ? this.levels : this.storedLevels );\n    },\n    currentLevel() {\n      return this.user && ( !this.user.as || this.user.as.subscriber )\n         && this.user.membership || false;\n    },\n    targetPost() { return this.target; }\n  }\n};\n","module.exports = \"<div class=\\\"subscription-menu container\\\">\\n  <transition name=\\\"fade-fast\\\" mode=\\\"out-in\\\">\\n    <div v-if=\\\"confirmed\\\" class=\\\"row success\\\" key=\\\"success\\\">\\n      <h2>Success!</h2>\\n      <div class=\\\"welcome col-12\\\">You've succesfully signed up for the {{\\n        currentLevel.name }} package. <span v-if=\\\"targetPost\\\">You can now see\\n          the content you were trying to view\\n          <router-link :to=\\\"targetPost\\\">here</router-link>.</span>\\n      </div>\\n    </div>\\n    <div v-else-if=\\\"selectedLevel\\\" class=\\\"confirm container\\\" key=\\\"confirm\\\">\\n      <h2 class=\\\"message\\\">Confirm Order</h2>\\n      <b-table striped hover :items=\\\"order\\\" :fields=\\\"order_fields\\\" stacked=\\\"sm\\\"\\n               class=\\\"order\\\"></b-table>\\n      <div class=\\\"actions\\\">\\n        <b-btn class=\\\"col-6 col-md-3 col-lg-2 submit confirm checkout paypal paypal-express\\\"\\n               @click.stop=\\\"getConfirmation\\\"\\n               variant=\\\"warning\\\">checkout</b-btn>\\n        <b-btn class=\\\"col-6 col-md-3 col-lg-2 cancel\\\" @click.stop=\\\"unsetLevel\\\"\\n               variant=\\\"link\\\">go back</b-btn>\\n      </div>\\n    </div>\\n    <div v-else class=\\\"row\\\" key=\\\"select\\\">\\n      <div class=\\\"description col-12\\\"><slot></slot></div>\\n      <div v-for=\\\"level in memberLevels\\\" :key=\\\"level.id\\\"\\n           class=\\\"col-12 col-md-4\\\">\\n        <b-card no-body\\n                :class=\\\"[ 'member-level', { current: currentLevel.id == level.id }]\\\"\\n                :header=\\\"level.name\\\"\\n                @click=\\\"setLevel( level )\\\">\\n          <b-card-body>\\n            <div class=\\\"description\\\" v-html=\\\"level.description\\\"></div>\\n            <div class=\\\"price\\\">${{\\n              level.initial_payment || level.billing_amount }}</div>\\n          </b-card-body>\\n          <b-card-footer v-if=\\\"currentLevel.id == level.id\\\" class=\\\"selected\\\">\\n            expires {{ user.membership.expires }}\\n          </b-card-footer>\\n          <b-card-footer v-else class=\\\"buy\\\">\\n            <!-- <router-link :to=\\\"'/members/signup/' + level.id\\\"></router-link> -->\\n            <a href=\\\"#\\\" @click.stop=\\\"setLevel( level )\\\">{{\\n              user ? 'select' : 'sign up'\\n              }}</a>\\n          </b-card-footer>\\n        </b-card>\\n      </div>\\n    </div>\\n  </transition>\\n</div>\\n\";"],"sourceRoot":""}